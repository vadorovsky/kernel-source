From: Andreas Gruenbacher <agruen@suse.de>
Subject: Disable file capabilities by default; file_caps=<0|1> option

Disable file capabilities by default: we are still lacking documentation
and file capability awareness in system management tools.

SLES 11 supports a file_caps=<0|1> switch, while the corresponding mailine
switches are called file_caps and no_file_caps.  This patch adds support
for the SLES 11 syntax for compatibility.
(Support for the SLES 11 specific syntax will be removed at some future time.)

Signed-off-by: Andreas Gruenbacher <agruen@suse.de>

---
 Documentation/kernel-parameters.txt |    8 +++++++-
 kernel/capability.c                 |    9 ++++++++-
 2 files changed, 15 insertions(+), 2 deletions(-)

Index: linux-3.0-tmp-jikos/Documentation/kernel-parameters.txt
===================================================================
--- linux-3.0-tmp-jikos.orig/Documentation/kernel-parameters.txt
+++ linux-3.0-tmp-jikos/Documentation/kernel-parameters.txt
@@ -1700,7 +1700,18 @@ bytes respectively. Such letter suffixes
 
 	no_file_caps	Tells the kernel not to honor file capabilities.  The
 			only way then for a file to be executed with privilege
-			is to be setuid root or executed by root.
+			is to be setuid root or executed by root. They
+			default to disabled.
+
+	file_caps	Tells the kernel to honor file capabilities.  The
+			only way then for a file to be executed with privilege
+			is to be setuid root or executed by root. They default
+			to disabled.
+
+	file_caps=	Format=<0|1>
+			Same as file_caps and no_file_caps, depending on the value.
+			This variant exists because of backwards compatibility with
+			SLES 11, and will go away at some point in the future.
 
 	nohalt		[IA-64] Tells the kernel not to use the power saving
 			function PAL_HALT_LIGHT when idle. This increases
Index: linux-3.0-tmp-jikos/kernel/capability.c
===================================================================
--- linux-3.0-tmp-jikos.orig/kernel/capability.c
+++ linux-3.0-tmp-jikos/kernel/capability.c
@@ -25,7 +25,7 @@ const kernel_cap_t __cap_empty_set = CAP
 
 EXPORT_SYMBOL(__cap_empty_set);
 
-int file_caps_enabled = 1;
+int file_caps_enabled;
 
 static int __init file_caps_disable(char *str)
 {
@@ -34,6 +34,14 @@ static int __init file_caps_disable(char
 }
 __setup("no_file_caps", file_caps_disable);
 
+
+static int __init file_caps_enable(char *str)
+{
+	file_caps_enabled = str[0] == '\0' || (str[0] == '=' && str[1] == '1');
+	return 1;
+}
+__setup("file_caps", file_caps_enable);
+
 /*
  * More recent versions of libcap are available from:
  *
