From: Tsutomu Itoh <t-itoh@jp.fujitsu.com>
Date: Wed, 9 Apr 2014 09:18:04 +0900
Patch-mainline: 3.16
Git-commit: 59885b39303edc0b3284f324a1ca42cb6e7742d0
Subject: [PATCH] Btrfs: fix possible memory leak in btrfs_create_tree()

In btrfs_create_tree(), if btrfs_insert_root() fails, we should
free root->commit_root.

Reported-by: Alex Lyakas <alex@zadarastorage.com>
Signed-off-by: Tsutomu Itoh <t-itoh@jp.fujitsu.com>
Signed-off-by: Chris Mason <clm@fb.com>
Signed-off-by: David Sterba <dsterba@suse.cz>
---
 fs/btrfs/disk-io.c |    1 +
 1 file changed, 1 insertion(+)

--- a/fs/btrfs/disk-io.c
+++ b/fs/btrfs/disk-io.c
@@ -1337,6 +1337,7 @@ struct btrfs_root *btrfs_create_tree(str
 fail:
 	if (leaf) {
 		btrfs_tree_unlock(leaf);
+		free_extent_buffer(root->commit_root);
 		free_extent_buffer(leaf);
 	}
 	kfree(root);
