From: Masahiro Yamada <yamada.masahiro@socionext.com>
Date: Wed, 6 Jan 2016 13:25:09 +0900
Subject: clk: add clk_unregister_fixed_factor()
Git-commit: cbf9591f665d44f40795afe2eee4fcbcd32575d6
Patch-mainline: v4.6-rc1
References: bsc#1032150

Allow to unregister fixed factor clock.

Signed-off-by: Masahiro Yamada <yamada.masahiro@socionext.com>
Signed-off-by: Stephen Boyd <sboyd@codeaurora.org>
Signed-off-by: Matthias Brugger <mbrugger@suse.com>
---
 drivers/clk/clk-fixed-factor.c |   13 +++++++++++++
 include/linux/clk-provider.h   |    1 +
 2 files changed, 14 insertions(+)

--- a/drivers/clk/clk-fixed-factor.c
+++ b/drivers/clk/clk-fixed-factor.c
@@ -128,6 +128,19 @@ void clk_hw_unregister_fixed_factor(stru
 }
 EXPORT_SYMBOL_GPL(clk_hw_unregister_fixed_factor);
 
+void clk_unregister_fixed_factor(struct clk *clk)
+{
+	struct clk_hw *hw;
+
+	hw = __clk_get_hw(clk);
+	if (!hw)
+		return;
+
+	clk_unregister(clk);
+	kfree(to_clk_fixed_factor(hw));
+}
+EXPORT_SYMBOL_GPL(clk_unregister_fixed_factor);
+
 #ifdef CONFIG_OF
 /**
  * of_fixed_factor_clk_setup() - Setup function for simple fixed factor clock
--- a/include/linux/clk-provider.h
+++ b/include/linux/clk-provider.h
@@ -531,6 +531,7 @@ extern const struct clk_ops clk_fixed_fa
 struct clk *clk_register_fixed_factor(struct device *dev, const char *name,
 		const char *parent_name, unsigned long flags,
 		unsigned int mult, unsigned int div);
+void clk_unregister_fixed_factor(struct clk *clk);
 struct clk_hw *clk_hw_register_fixed_factor(struct device *dev,
 		const char *name, const char *parent_name, unsigned long flags,
 		unsigned int mult, unsigned int div);
