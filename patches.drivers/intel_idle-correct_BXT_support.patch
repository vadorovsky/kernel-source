From: Jan Beulich <JBeulich@suse.com>
Subject: intel_idle: correct BXT support
References: fate#321284
Patch-Mainline: v4.8-rc1
Git-commit: bef450962597ff39a7f9d53a30523aae9eb55843
Git-repo: git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git

Signed-off-by: Thomas Renninger <trenn@suse.de>

Commit 5dcef69486 ("intel_idle: add BXT support") added an 8-element
lookup array with just a 2-bit value used for lookups. As per the SDM
that bit field is really 3 bits wide. While this is supposedly benign
here, future re-use of the code for other CPUs might expose the issue.

Signed-off-by: Jan Beulich <jbeulich@suse.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

---
 drivers/idle/intel_idle.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/drivers/idle/intel_idle.c
+++ b/drivers/idle/intel_idle.c
@@ -1197,7 +1197,7 @@ static unsigned long long irtl_2_usec(un
 {
 	unsigned long long ns;
 
-	ns = irtl_ns_units[(irtl >> 10) & 0x3];
+	ns = irtl_ns_units[(irtl >> 10) & 0x7];
 
 	return div64_u64((irtl & 0x3FF) * ns, 1000);
 }
