Subject: Provide boot option to disable sched_rt_runtime
From: Jack Steiner <steiner@sgi.com>
Patch-mainline: no
References: bnc#610783

Very large machines may livelock due to scalability issues, so give the
user the ability to boot time disable realtime bandwidth control.

Signed-off-by: Mike Galbraith <mgalbraith@suse.de>

---
 Documentation/kernel-parameters.txt |    2 ++
 kernel/sched.c                      |   11 +++++++++++
 2 files changed, 13 insertions(+)

Index: linux-2.6.32-SLE11-SP1/kernel/sched.c
===================================================================
--- linux-2.6.32-SLE11-SP1.orig/kernel/sched.c
+++ linux-2.6.32-SLE11-SP1/kernel/sched.c
@@ -824,6 +824,17 @@ static __read_mostly int scheduler_runni
  */
 int sysctl_sched_rt_runtime = 950000;
 
+/*
+ * Bootline option to disable sched_rt_runtime.  Otherwise very large
+ * systems livelock during boot.
+ */
+static int __init parse_nortsched(char *arg)
+{
+	sysctl_sched_rt_runtime = -1;
+	return 0;
+}
+early_param("nortsched", parse_nortsched);
+
 static inline u64 global_rt_period(void)
 {
 	return (u64)sysctl_sched_rt_period * NSEC_PER_USEC;
Index: linux-2.6.32-SLE11-SP1/Documentation/kernel-parameters.txt
===================================================================
--- linux-2.6.32-SLE11-SP1.orig/Documentation/kernel-parameters.txt
+++ linux-2.6.32-SLE11-SP1/Documentation/kernel-parameters.txt
@@ -2193,6 +2193,8 @@ and is between 256 and 4096 characters.
 	rtsched_debug	[KNL] Disallows borrowing of excess rt_runtime from neighboring runqueues.
                         /proc/sys/kernel/sched_rt_runtime_us becomes a hard limit per runqueue.
 
+	nortsched	[KNL] Disables realtime task bandwidth control.
+
 	sc1200wdt=	[HW,WDT] SC1200 WDT (watchdog) driver
 			Format: <io>[,<timeout>[,<isapnp>]]
 
