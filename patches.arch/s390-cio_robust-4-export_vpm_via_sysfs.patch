From: Sebastian Ott <sebott@linux.vnet.ibm.com>
Subject: s390/cio: export vpm via sysfs
Patch-mainline: v3.9-rc1
Git-commit: 84c57ad5d938ff28d85ac93b79c1f918a767a23e
References: bnc#837741,LTC#97048

Add new attribute "vpm" to the subchannel sysfs directory of I/O
subchannels. This attribute contains a path mask indicating which
channel paths were successfully verified to be usable for I/O.

Signed-off-by: Sebastian Ott <sebott@linux.vnet.ibm.com>
Acked-by: John Jolly <jjolly@suse.de>
---
 drivers/s390/cio/device.c |   10 ++++++++++
 1 file changed, 10 insertions(+)

--- a/drivers/s390/cio/device.c
+++ b/drivers/s390/cio/device.c
@@ -633,6 +633,14 @@ initiate_logging(struct device *dev, str
 	return count;
 }
 
+static ssize_t vpm_show(struct device *dev, struct device_attribute *attr,
+			char *buf)
+{
+	struct subchannel *sch = to_subchannel(dev);
+
+	return sprintf(buf, "%02x\n", sch->vpm);
+}
+
 static DEVICE_ATTR(chpids, 0444, chpids_show, NULL);
 static DEVICE_ATTR(pimpampom, 0444, pimpampom_show, NULL);
 static DEVICE_ATTR(devtype, 0444, devtype_show, NULL);
@@ -641,11 +649,13 @@ static DEVICE_ATTR(modalias, 0444, modal
 static DEVICE_ATTR(online, 0644, online_show, online_store);
 static DEVICE_ATTR(availability, 0444, available_show, NULL);
 static DEVICE_ATTR(logging, 0200, NULL, initiate_logging);
+static DEVICE_ATTR(vpm, 0444, vpm_show, NULL);
 
 static struct attribute *io_subchannel_attrs[] = {
 	&dev_attr_chpids.attr,
 	&dev_attr_pimpampom.attr,
 	&dev_attr_logging.attr,
+	&dev_attr_vpm.attr,
 	NULL,
 };
 
