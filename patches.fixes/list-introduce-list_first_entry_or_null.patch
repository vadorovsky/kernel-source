From: Jiri Pirko <jiri@resnulli.us>
Date: Wed, 29 May 2013 05:02:56 +0000
Subject: [PATCH v3] list: introduce list_first_entry_or_null
Patch-mainline: v3.10-rc5
Git-commit: 6d7581e62f8be462440d7b22c6361f7c9fa4902b
References: bsc#909484 FATE#317397 bnc#1027565 CVE-2017-2636

non-rcu variant of list_first_or_null_rcu

Signed-off-by: Jiri Pirko <jiri@resnulli.us>
Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: David Chang <dchang@suse.com>
Signed-off-by: Jiri Slaby <jslaby@suse.cz>
---
 include/linux/list.h |   11 +++++++++++
 1 file changed, 11 insertions(+)

--- a/include/linux/list.h
+++ b/include/linux/list.h
@@ -362,6 +362,17 @@ static inline void list_splice_tail_init
 	list_entry((ptr)->next, type, member)
 
 /**
+ * list_first_entry_or_null - get the first element from a list
+ * @ptr:	the list head to take the element from.
+ * @type:	the type of the struct this is embedded in.
+ * @member:	the name of the list_struct within the struct.
+ *
+ * Note that if the list is empty, it returns NULL.
+ */
+#define list_first_entry_or_null(ptr, type, member) \
+	(!list_empty(ptr) ? list_first_entry(ptr, type, member) : NULL)
+
+/**
  * list_for_each	-	iterate over a list
  * @pos:	the &struct list_head to use as a loop cursor.
  * @head:	the head for your list.
