From: NeilBrown <neilb@suse.de>
Subject: Avoid softlockup in shrink_dcache_for_umount_subtree.
Patch-mainline: no
References: bnc#834473

If there are lots of cached dentries for an NFS filesystem, unmount
can take a long time - long enough to trigger the soft lockup warning.

Signed-off-by: Neil Brown <neilb@suse.de>

---
 fs/dcache.c |    1 +
 1 file changed, 1 insertion(+)

--- linux-3.0-SLE11-SP2.orig/fs/dcache.c
+++ linux-3.0-SLE11-SP2/fs/dcache.c
@@ -992,6 +992,7 @@ void shrink_dcache_for_umount_subtree(st
 			if (!parent)
 				return;
 			dentry = parent;
+			cond_resched();
 		} while (list_empty(&dentry->d_subdirs));
 
 		dentry = list_entry(dentry->d_subdirs.next,
